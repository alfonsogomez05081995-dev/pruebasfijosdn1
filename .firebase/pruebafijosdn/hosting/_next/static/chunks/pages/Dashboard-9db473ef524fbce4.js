(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[28],{4266:(e,s,r)=>{"use strict";r.d(s,{A:()=>t}),r(7876);var i=r(4232);r(9917),r(2964),r(8269);let a=(0,i.createContext)();function t(){return(0,i.useContext)(a)}},6972:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>C});var i=r(7876),a=r(4232),t=r(974),l=r(6364),n=r(8487),d=r(2513),c=r(1465),o=r(4266),h=r(9099),x=r(5215),u=r(8451),j=r(3440),p=r(7145),m=r(3629),A=r(2964),v=r(9917),b=r(8269);function g(){let{currentUser:e}=(0,o.A)(),[s,r]=(0,a.useState)([]),[h,g]=(0,a.useState)([]),[y,S]=(0,a.useState)([]),[C,f]=(0,a.useState)(!0),[N,w]=(0,a.useState)(""),[E,G]=(0,a.useState)(""),[k,I]=(0,a.useState)(!1),[D,H]=(0,a.useState)(!1),[B,P]=(0,a.useState)(!1),[L,q]=(0,a.useState)({email:"",password:"",nombre:"",apellido:"",role:"employee"}),[T,z]=(0,a.useState)({serial:"",description:"",type:"pc",status:"disponible"}),[_,U]=(0,a.useState)({selectedUser:"",selectedAssets:[]}),[M,J]=(0,a.useState)("all"),R=()=>{w(""),G("")},F=(0,a.useCallback)(async()=>{f(!0);try{let s=await (0,A.GG)((0,A.rJ)(b.db,"assets"));r(s.docs.map(e=>({id:e.id,...e.data()})));let i=await (0,A.GG)((0,A.rJ)(b.db,"users"));g(i.docs.map(e=>({id:e.id,...e.data()})));let a=await (0,A.GG)((0,A.P)((0,A.rJ)(b.db,"requests"),(0,A._M)("requesterId","==",e.uid)));S(a.docs.map(e=>({id:e.id,...e.data()})))}catch(e){w("Error al cargar los datos. "+e.message)}f(!1)},[e.uid]);(0,a.useEffect)(()=>{F()},[F]);let O=async e=>{if(e.preventDefault(),R(),console.log("Attempting to create user..."),!L.email||!L.password||!L.nombre||!L.role){w("Por favor, completa todos los campos obligatorios."),console.log("Validation failed: Missing required fields.");return}try{let e=(0,v.xI)(),s=(await (0,v.eJ)(e,L.email,L.password)).user;console.log("User created in Firebase Auth:",s.uid),await (0,A.BN)((0,A.H9)(b.db,"users",s.uid),{nombre:L.nombre,apellido:L.apellido,email:L.email,email_lowercase:L.email.toLowerCase(),role:L.role,createdAt:new Date}),console.log("User details added to Firestore."),G("Usuario ".concat(L.email," creado con \xe9xito.")),I(!1),q({email:"",password:"",nombre:"",apellido:"",role:"employee"}),F()}catch(e){console.error("Error during user creation:",e),w("Error al crear usuario: ".concat(e.message))}},Z=async e=>{e.preventDefault(),R()},X=e=>{U(s=>{let r=s.selectedAssets.includes(e)?s.selectedAssets.filter(s=>s!==e):[...s.selectedAssets,e];return{...s,selectedAssets:r}})},V=async r=>{if(r.preventDefault(),R(),!_.selectedUser||0===_.selectedAssets.length)return void w("Debes seleccionar un empleado y al menos un activo.");try{let r=s.filter(e=>_.selectedAssets.includes(e.id)).every(e=>"disponible"===e.status),i=r?"Pendiente de Env\xedo":"Pendiente por Stock",a=await (0,A.gS)((0,A.rJ)(b.db,"requests"),{requesterId:e.uid,employeeId:_.selectedUser,assetIds:_.selectedAssets,status:i,createdAt:new Date});if(r){let e=(0,A.wP)(b.db);_.selectedAssets.forEach(s=>{let r=(0,A.H9)(b.db,"assets",s);e.update(r,{status:"asignado",assignedTo:_.selectedUser})}),await e.commit(),console.log("NOTIFICACI\xd3N: Nueva solicitud de asignaci\xf3n (".concat(a.id,") creada. Notificar al personal de log\xedstica."))}else console.log("ALERTA: Solicitud (".concat(a.id,") creada con stock pendiente. Notificar a todos los actores."));G("Solicitud de asignaci\xf3n creada con estado: ".concat(i,".")),P(!1),U({selectedUser:"",selectedAssets:[]}),F()}catch(e){w("Error al crear la solicitud: ".concat(e.message))}};return C?(0,i.jsx)(l.A,{className:"text-center mt-5",children:(0,i.jsx)("p",{children:"Cargando..."})}):(0,i.jsxs)(l.A,{fluid:!0,children:[(0,i.jsx)(n.A,{className:"my-4",children:(0,i.jsxs)(d.A,{children:[(0,i.jsx)("h2",{children:"Dashboard - Master"}),N&&(0,i.jsx)(x.A,{variant:"danger",onClose:()=>w(""),dismissible:!0,children:N}),E&&(0,i.jsx)(x.A,{variant:"success",onClose:()=>G(""),dismissible:!0,children:E})]})}),(0,i.jsxs)(n.A,{className:"mb-4",children:[(0,i.jsx)(d.A,{md:4,children:(0,i.jsxs)(t.A,{children:[(0,i.jsx)(t.A.Header,{children:"Gesti\xf3n de Usuarios"}),(0,i.jsx)(t.A.Body,{children:(0,i.jsx)(c.A,{variant:"primary",onClick:()=>{console.log("Crear Usuario button clicked."),R(),I(!0)},children:"Crear Usuario"})})]})}),(0,i.jsx)(d.A,{md:4,children:(0,i.jsxs)(t.A,{children:[(0,i.jsx)(t.A.Header,{children:"Gesti\xf3n de Activos"}),(0,i.jsx)(t.A.Body,{children:(0,i.jsx)(c.A,{variant:"secondary",onClick:()=>{R(),H(!0)},children:"Crear Activo"})})]})}),(0,i.jsx)(d.A,{md:4,children:(0,i.jsxs)(t.A,{children:[(0,i.jsx)(t.A.Header,{children:"Asignaci\xf3n de Activos"}),(0,i.jsx)(t.A.Body,{children:(0,i.jsx)(c.A,{variant:"success",onClick:()=>{R(),P(!0)},children:"Solicitar Asignaci\xf3n"})})]})})]}),(0,i.jsx)(n.A,{className:"mb-4",children:(0,i.jsx)(d.A,{children:(0,i.jsxs)(t.A,{children:[(0,i.jsx)(t.A.Header,{children:(0,i.jsx)("h5",{children:"Solicitudes de Asignaci\xf3n"})}),(0,i.jsx)(t.A.Body,{children:(0,i.jsxs)(u.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,size:"sm",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"ID de Solicitud"}),(0,i.jsx)("th",{children:"Empleado"}),(0,i.jsx)("th",{children:"Estado"}),(0,i.jsx)("th",{children:"Fecha"})]})}),(0,i.jsx)("tbody",{children:y.map(e=>{var s;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.id}),(0,i.jsx)("td",{children:(null==(s=h.find(s=>s.id===e.employeeId))?void 0:s.nombre)||"N/A"}),(0,i.jsx)("td",{children:(0,i.jsx)(j.A,{bg:"info",children:e.status})}),(0,i.jsx)("td",{children:e.createdAt.toDate().toLocaleDateString()})]},e.id)})})]})})]})})}),(0,i.jsx)(n.A,{children:(0,i.jsx)(d.A,{children:(0,i.jsxs)(t.A,{children:[(0,i.jsx)(t.A.Header,{children:(0,i.jsx)("h5",{children:"Activos Registrados"})}),(0,i.jsx)(t.A.Body,{})]})})}),(0,i.jsxs)(p.A,{show:k,onHide:()=>I(!1),children:[(0,i.jsx)(p.A.Header,{closeButton:!0,children:(0,i.jsx)(p.A.Title,{children:"Crear Nuevo Usuario"})}),(0,i.jsx)(p.A.Body,{children:(0,i.jsxs)(m.A,{onSubmit:O,children:[(0,i.jsxs)(m.A.Group,{className:"mb-3",children:[(0,i.jsx)(m.A.Label,{children:"Email"}),(0,i.jsx)(m.A.Control,{type:"email",value:L.email,onChange:e=>q({...L,email:e.target.value}),required:!0})]}),(0,i.jsxs)(m.A.Group,{className:"mb-3",children:[(0,i.jsx)(m.A.Label,{children:"Contrase\xf1a"}),(0,i.jsx)(m.A.Control,{type:"password",value:L.password,onChange:e=>q({...L,password:e.target.value}),required:!0})]}),(0,i.jsxs)(m.A.Group,{className:"mb-3",children:[(0,i.jsx)(m.A.Label,{children:"Nombre"}),(0,i.jsx)(m.A.Control,{type:"text",value:L.nombre,onChange:e=>q({...L,nombre:e.target.value}),required:!0})]}),(0,i.jsxs)(m.A.Group,{className:"mb-3",children:[(0,i.jsx)(m.A.Label,{children:"Apellido"}),(0,i.jsx)(m.A.Control,{type:"text",value:L.apellido,onChange:e=>q({...L,apellido:e.target.value})})]}),(0,i.jsxs)(m.A.Group,{className:"mb-3",children:[(0,i.jsx)(m.A.Label,{children:"Rol"}),(0,i.jsxs)(m.A.Select,{value:L.role,onChange:e=>q({...L,role:e.target.value}),children:[(0,i.jsx)("option",{value:"employee",children:"Empleado"}),(0,i.jsx)("option",{value:"logistic",children:"Log\xedstica"}),(0,i.jsx)("option",{value:"master",children:"Master"})]})]}),(0,i.jsx)(c.A,{variant:"primary",type:"submit",children:"Crear"})]})})]}),(0,i.jsxs)(p.A,{show:D,onHide:()=>H(!1),children:[(0,i.jsx)(p.A.Header,{closeButton:!0,children:(0,i.jsx)(p.A.Title,{children:"Crear Nuevo Activo"})}),(0,i.jsx)(p.A.Body,{children:(0,i.jsxs)(m.A,{onSubmit:Z,children:[(0,i.jsxs)(m.A.Group,{className:"mb-3",children:[(0,i.jsx)(m.A.Label,{children:"Serial"}),(0,i.jsx)(m.A.Control,{type:"text",value:T.serial,onChange:e=>z({...T,serial:e.target.value}),required:!0})]}),(0,i.jsxs)(m.A.Group,{className:"mb-3",children:[(0,i.jsx)(m.A.Label,{children:"Descripci\xf3n"}),(0,i.jsx)(m.A.Control,{type:"text",value:T.description,onChange:e=>z({...T,description:e.target.value}),required:!0})]}),(0,i.jsxs)(m.A.Group,{className:"mb-3",children:[(0,i.jsx)(m.A.Label,{children:"Tipo"}),(0,i.jsxs)(m.A.Select,{value:T.type,onChange:e=>z({...T,type:e.target.value}),children:[(0,i.jsx)("option",{value:"pc",children:"PC"}),(0,i.jsx)("option",{value:"monitor",children:"Monitor"}),(0,i.jsx)("option",{value:"keyboard",children:"Teclado"}),(0,i.jsx)("option",{value:"mouse",children:"Mouse"}),(0,i.jsx)("option",{value:"other",children:"Otro"})]})]}),(0,i.jsx)(c.A,{variant:"primary",type:"submit",children:"Crear Activo"})]})})]}),(0,i.jsxs)(p.A,{show:B,onHide:()=>P(!1),size:"lg",children:[(0,i.jsx)(p.A.Header,{closeButton:!0,children:(0,i.jsx)(p.A.Title,{children:"Solicitar Asignaci\xf3n de Activo"})}),(0,i.jsx)(p.A.Body,{children:(0,i.jsxs)(m.A,{onSubmit:V,children:[(0,i.jsxs)(m.A.Group,{className:"mb-3",children:[(0,i.jsx)(m.A.Label,{children:"Seleccionar Empleado"}),(0,i.jsxs)(m.A.Select,{value:_.selectedUser,onChange:e=>U({..._,selectedUser:e.target.value}),required:!0,children:[(0,i.jsx)("option",{value:"",children:"Selecciona un empleado..."}),h.filter(e=>"employee"===e.role).map(e=>(0,i.jsxs)("option",{value:e.id,children:[e.nombre," ",e.apellido]},e.id))]})]}),(0,i.jsx)("hr",{}),(0,i.jsx)("h6",{children:"Seleccionar Activos"}),(0,i.jsxs)(m.A.Group,{className:"mb-3",children:[(0,i.jsx)(m.A.Label,{children:"Filtrar por tipo de activo"}),(0,i.jsxs)(m.A.Select,{value:M,onChange:e=>J(e.target.value),children:[(0,i.jsx)("option",{value:"all",children:"Todos"}),[...new Set(s.map(e=>e.type))].map(e=>(0,i.jsx)("option",{value:e,children:e},e))]})]}),(0,i.jsxs)(u.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,size:"sm",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{}),(0,i.jsx)("th",{children:"Serial"}),(0,i.jsx)("th",{children:"Descripci\xf3n"}),(0,i.jsx)("th",{children:"Tipo"}),(0,i.jsx)("th",{children:"Estado"})]})}),(0,i.jsx)("tbody",{children:s.filter(e=>"all"===M||e.type===M).map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)(m.A.Check,{type:"checkbox",checked:_.selectedAssets.includes(e.id),onChange:()=>X(e.id)})}),(0,i.jsx)("td",{children:e.serial}),(0,i.jsx)("td",{children:e.description}),(0,i.jsx)("td",{children:(0,i.jsx)(j.A,{bg:"info",children:e.type})}),(0,i.jsx)("td",{children:(0,i.jsx)(j.A,{bg:"disponible"===e.status?"success":"warning",children:e.status})})]},e.id))})]}),(0,i.jsx)(c.A,{variant:"primary",type:"submit",children:"Crear Solicitud"})]})})]})]})}function y(){let[e,s]=(0,a.useState)([]),[r,o]=(0,a.useState)([]),[h,v]=(0,a.useState)([]),[g,y]=(0,a.useState)(!0),[S,C]=(0,a.useState)(""),[f,N]=(0,a.useState)(""),[w,E]=(0,a.useState)(!1),[G,k]=(0,a.useState)(null),[I,D]=(0,a.useState)({serial:"",description:"",type:"pc",status:"disponible",location:""}),H=()=>{C(""),N("")},B=(0,a.useCallback)(async()=>{y(!0);try{let e=await (0,A.GG)((0,A.rJ)(b.db,"assets"));s(e.docs.map(e=>({id:e.id,...e.data()})));let r=await (0,A.GG)((0,A.rJ)(b.db,"users"));o(r.docs.map(e=>({id:e.id,...e.data()})));let i=await (0,A.GG)((0,A.rJ)(b.db,"requests"));v(i.docs.map(e=>({id:e.id,...e.data()})))}catch(e){C("Error al cargar los datos. "+e.message)}y(!1)},[]);(0,a.useEffect)(()=>{B()},[B]);let P=async e=>{e.preventDefault(),H();let s=["pc","monitor","keyboard","mouse","herramienta_electrica"].includes(I.type);if(s&&!I.serial)return void C("El serial es obligatorio para este tipo de activo.");if(!I.description||!I.type||!I.location)return void C("Por favor, completa todos los campos obligatorios (Descripci\xf3n, Tipo, Ubicaci\xf3n).");try{if(s&&I.serial){let e=(0,A.P)((0,A.rJ)(b.db,"assets"),(0,A._M)("serial","==",I.serial));if(!(await (0,A.GG)(e)).empty)return void C("El serial ".concat(I.serial," ya existe. Por favor, verifica."))}await (0,A.gS)((0,A.rJ)(b.db,"assets"),{...I,serial:s?I.serial:null,createdAt:new Date}),N("Activo ".concat(I.description," (Serial: ").concat(I.serial||"N/A",") creado con \xe9xito.")),E(!1),D({serial:"",description:"",type:"pc",status:"disponible",location:""}),B()}catch(e){C("Error al crear el activo: ".concat(e.message))}},L=async e=>{try{let s=(0,A.H9)(b.db,"requests",e.id);await (0,A.mZ)(s,{status:"En Proceso"}),N("Solicitud ".concat(e.id," marcada como 'En Proceso'.")),B()}catch(e){C("Error al marcar como enviado: ".concat(e.message))}},q=e=>{alert("Gestionar stock para solicitud ".concat(e.id,". (Funcionalidad pendiente)"))},T=s=>e.find(e=>e.id===s),z=e=>r.find(s=>s.id===e);if(g)return(0,i.jsx)(l.A,{className:"text-center mt-5",children:(0,i.jsx)("p",{children:"Cargando..."})});let _=h.filter(e=>"Pendiente de Env\xedo"===e.status||"Pendiente por Stock"===e.status||"Rechazado"===e.status),U=h.filter(e=>"Completada"===e.status);return(0,i.jsxs)(l.A,{fluid:!0,children:[(0,i.jsx)(n.A,{className:"my-4",children:(0,i.jsxs)(d.A,{children:[(0,i.jsx)("h2",{children:"Dashboard - Log\xedstica"}),S&&(0,i.jsx)(x.A,{variant:"danger",onClose:()=>C(""),dismissible:!0,children:S}),f&&(0,i.jsx)(x.A,{variant:"success",onClose:()=>N(""),dismissible:!0,children:f})]})}),(0,i.jsx)(n.A,{className:"mb-4",children:(0,i.jsx)(d.A,{children:(0,i.jsxs)(t.A,{children:[(0,i.jsx)(t.A.Header,{children:(0,i.jsx)("h5",{children:"Gesti\xf3n de Solicitudes"})}),(0,i.jsx)(t.A.Body,{children:(0,i.jsxs)(u.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,size:"sm",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"ID Solicitud"}),(0,i.jsx)("th",{children:"Solicitante"}),(0,i.jsx)("th",{children:"Empleado Destino"}),(0,i.jsx)("th",{children:"Activos"}),(0,i.jsx)("th",{children:"Estado"}),(0,i.jsx)("th",{children:"Acciones"})]})}),(0,i.jsx)("tbody",{children:_.map(e=>{var s,r;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.id}),(0,i.jsx)("td",{children:(null==(s=z(e.requesterId))?void 0:s.nombre)||"N/A"}),(0,i.jsx)("td",{children:(null==(r=z(e.employeeId))?void 0:r.nombre)||"N/A"}),(0,i.jsx)("td",{children:(0,i.jsx)("ul",{children:e.assetIds.map(e=>{let s=T(e);return s?(0,i.jsxs)("li",{children:[s.description," (Serial: ",s.serial,")"]},e):null})})}),(0,i.jsxs)("td",{children:[(0,i.jsx)(j.A,{bg:"Pendiente de Env\xedo"===e.status?"info":"Pendiente por Stock"===e.status?"warning":"danger",children:e.status}),e.comments&&(0,i.jsxs)("p",{className:"text-muted",children:["Comentarios: ",e.comments]})]}),(0,i.jsxs)("td",{children:["Pendiente de Env\xedo"===e.status&&(0,i.jsx)(c.A,{variant:"success",size:"sm",onClick:()=>L(e),children:"Marcar como Enviado"}),"Pendiente por Stock"===e.status&&(0,i.jsx)(c.A,{variant:"warning",size:"sm",onClick:()=>q(e),children:"Gestionar Stock"})]})]},e.id)})})]})})]})})}),(0,i.jsx)(n.A,{className:"mb-4",children:(0,i.jsx)(d.A,{children:(0,i.jsxs)(t.A,{children:[(0,i.jsx)(t.A.Header,{children:(0,i.jsx)("h5",{children:"Inventario de Activos"})}),(0,i.jsxs)(t.A.Body,{children:[(0,i.jsx)(c.A,{variant:"primary",onClick:()=>{H(),E(!0)},children:"Ingresar Nuevo Activo"}),(0,i.jsxs)(u.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,size:"sm",className:"mt-3",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Serial"}),(0,i.jsx)("th",{children:"Descripci\xf3n"}),(0,i.jsx)("th",{children:"Tipo"}),(0,i.jsx)("th",{children:"Estado"}),(0,i.jsx)("th",{children:"Asignado a"})]})}),(0,i.jsx)("tbody",{children:e.map(e=>{var s;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.serial}),(0,i.jsx)("td",{children:e.description}),(0,i.jsx)("td",{children:(0,i.jsx)(j.A,{bg:"info",children:e.type})}),(0,i.jsx)("td",{children:(0,i.jsx)(j.A,{bg:"disponible"===e.status?"success":"warning",children:e.status})}),(0,i.jsx)("td",{children:(null==(s=z(e.assignedTo))?void 0:s.nombre)||"N/A"})]},e.id)})})]})]})]})})}),(0,i.jsx)(n.A,{className:"mb-4",children:(0,i.jsx)(d.A,{children:(0,i.jsxs)(t.A,{children:[(0,i.jsx)(t.A.Header,{children:(0,i.jsx)("h5",{children:"Historial de Asignaciones Completadas"})}),(0,i.jsx)(t.A.Body,{children:(0,i.jsxs)(u.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,size:"sm",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"ID Solicitud"}),(0,i.jsx)("th",{children:"Empleado"}),(0,i.jsx)("th",{children:"Activos"}),(0,i.jsx)("th",{children:"Fecha Completada"})]})}),(0,i.jsx)("tbody",{children:U.map(e=>{var s;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.id}),(0,i.jsx)("td",{children:(null==(s=z(e.employeeId))?void 0:s.nombre)||"N/A"}),(0,i.jsx)("td",{children:(0,i.jsx)("ul",{children:e.assetIds.map(e=>{let s=T(e);return s?(0,i.jsxs)("li",{children:[s.description," (Serial: ",s.serial,")"]},e):null})})}),(0,i.jsx)("td",{children:e.createdAt.toDate().toLocaleDateString()})]},e.id)})})]})})]})})}),(0,i.jsxs)(p.A,{show:w,onHide:()=>E(!1),children:[(0,i.jsx)(p.A.Header,{closeButton:!0,children:(0,i.jsx)(p.A.Title,{children:"Ingresar Nuevo Activo"})}),(0,i.jsx)(p.A.Body,{children:(0,i.jsxs)(m.A,{onSubmit:P,children:[(0,i.jsxs)(m.A.Group,{className:"mb-3",children:[(0,i.jsx)(m.A.Label,{children:"Serial"}),(0,i.jsx)(m.A.Control,{type:"text",value:I.serial,onChange:e=>D({...I,serial:e.target.value}),placeholder:"Solo para equipos serializados"})]}),(0,i.jsxs)(m.A.Group,{className:"mb-3",children:[(0,i.jsx)(m.A.Label,{children:"Descripci\xf3n"}),(0,i.jsx)(m.A.Control,{type:"text",value:I.description,onChange:e=>D({...I,description:e.target.value}),required:!0})]}),(0,i.jsxs)(m.A.Group,{className:"mb-3",children:[(0,i.jsx)(m.A.Label,{children:"Tipo"}),(0,i.jsxs)(m.A.Select,{value:I.type,onChange:e=>D({...I,type:e.target.value}),children:[(0,i.jsx)("option",{value:"pc",children:"PC"}),(0,i.jsx)("option",{value:"monitor",children:"Monitor"}),(0,i.jsx)("option",{value:"keyboard",children:"Teclado"}),(0,i.jsx)("option",{value:"mouse",children:"Mouse"}),(0,i.jsx)("option",{value:"herramienta_electrica",children:"Herramienta El\xe9ctrica"}),(0,i.jsx)("option",{value:"herramienta_manual",children:"Herramienta Manual"}),(0,i.jsx)("option",{value:"other",children:"Otro"})]})]}),(0,i.jsxs)(m.A.Group,{className:"mb-3",children:[(0,i.jsx)(m.A.Label,{children:"Ubicaci\xf3n"}),(0,i.jsx)(m.A.Control,{type:"text",value:I.location,onChange:e=>D({...I,location:e.target.value}),required:!0})]}),(0,i.jsx)(c.A,{variant:"primary",type:"submit",children:"Crear Activo"})]})})]})]})}function S(){let{currentUser:e}=(0,o.A)(),[s,r]=(0,a.useState)([]),[h,v]=(0,a.useState)([]),[g,y]=(0,a.useState)(!0),[S,C]=(0,a.useState)(""),[f,N]=(0,a.useState)(""),[w,E]=(0,a.useState)(!1),[G,k]=(0,a.useState)(null),[I,D]=(0,a.useState)(""),H=(0,a.useCallback)(async()=>{if(e){y(!0);try{let s=(0,A.P)((0,A.rJ)(b.db,"requests"),(0,A._M)("employeeId","==",e.uid)),i=(await (0,A.GG)(s)).docs.map(e=>({id:e.id,...e.data()}));r(i);let a=(await (0,A.GG)((0,A.rJ)(b.db,"assets"))).docs.map(e=>({id:e.id,...e.data()}));v(a)}catch(e){C("Error al cargar los datos. "+e.message)}y(!1)}},[e]);(0,a.useEffect)(()=>{H()},[H]);let B=e=>{k(e),E(!0)},P=async()=>{if(G)try{let e=(0,A.H9)(b.db,"requests",G.id);await (0,A.mZ)(e,{status:"Completada"}),N("Recepci\xf3n confirmada con \xe9xito."),E(!1),H()}catch(e){C("Error al confirmar la recepci\xf3n: "+e.message)}},L=async()=>{if(!G||!I)return void C("Debes proporcionar un motivo de rechazo.");try{let e=(0,A.wP)(b.db),s=(0,A.H9)(b.db,"requests",G.id);e.update(s,{status:"Rechazado",comments:I}),G.assetIds.forEach(s=>{let r=(0,A.H9)(b.db,"assets",s);e.update(r,{status:"disponible",assignedTo:null})}),await e.commit(),N("La asignaci\xf3n ha sido rechazada."),E(!1),D(""),H()}catch(e){C("Error al rechazar la asignaci\xf3n: "+e.message)}},q=e=>h.find(s=>s.id===e);return g?(0,i.jsx)(l.A,{className:"text-center mt-5",children:(0,i.jsx)("p",{children:"Cargando..."})}):(0,i.jsxs)(l.A,{fluid:!0,children:[(0,i.jsx)(n.A,{className:"my-4",children:(0,i.jsxs)(d.A,{children:[(0,i.jsx)("h2",{children:"Mis Activos Asignados"}),S&&(0,i.jsx)(x.A,{variant:"danger",onClose:()=>C(""),dismissible:!0,children:S}),f&&(0,i.jsx)(x.A,{variant:"success",onClose:()=>N(""),dismissible:!0,children:f})]})}),(0,i.jsxs)(t.A,{children:[(0,i.jsx)(t.A.Header,{children:(0,i.jsx)("h5",{children:"Mis Solicitudes"})}),(0,i.jsx)(t.A.Body,{children:(0,i.jsxs)(u.A,{striped:!0,bordered:!0,hover:!0,responsive:!0,size:"sm",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"ID de Solicitud"}),(0,i.jsx)("th",{children:"Activos"}),(0,i.jsx)("th",{children:"Estado"}),(0,i.jsx)("th",{children:"Acciones"})]})}),(0,i.jsx)("tbody",{children:s.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.id}),(0,i.jsx)("td",{children:(0,i.jsx)("ul",{children:e.assetIds.map(e=>{let s=q(e);return s?(0,i.jsxs)("li",{children:[s.description," (Serial: ",s.serial,")"]},e):null})})}),(0,i.jsx)("td",{children:(0,i.jsx)(j.A,{bg:"primary",children:e.status})}),(0,i.jsx)("td",{children:("Pendiente de Env\xedo"===e.status||"En Proceso"===e.status)&&(0,i.jsx)(c.A,{variant:"primary",size:"sm",onClick:()=>B(e),children:"Gestionar Entrega"})})]},e.id))})]})})]}),(0,i.jsxs)(p.A,{show:w,onHide:()=>E(!1),children:[(0,i.jsx)(p.A.Header,{closeButton:!0,children:(0,i.jsx)(p.A.Title,{children:"Gestionar Entrega de Activos"})}),(0,i.jsxs)(p.A.Body,{children:[(0,i.jsx)("h5",{children:"Activos en esta entrega:"}),(0,i.jsx)("ul",{children:null==G?void 0:G.assetIds.map(e=>{let s=q(e);return s?(0,i.jsxs)("li",{children:[s.description," (Serial: ",s.serial,")"]},e):null})}),(0,i.jsx)("hr",{}),(0,i.jsxs)(m.A.Group,{className:"mb-3",children:[(0,i.jsx)(m.A.Label,{children:"Si rechazas la entrega, por favor explica el motivo:"}),(0,i.jsx)(m.A.Control,{as:"textarea",rows:3,value:I,onChange:e=>D(e.target.value)})]})]}),(0,i.jsxs)(p.A.Footer,{children:[(0,i.jsx)(c.A,{variant:"danger",onClick:L,disabled:!I,children:"Rechazar"}),(0,i.jsx)(c.A,{variant:"success",onClick:P,children:"Confirmar Recibido"})]})]})]})}function C(){let{userRole:e,userData:s,logout:r}=(0,o.A)()||{},a=(0,h.useRouter)(),x=async()=>{try{await r(),a.push("/login")}catch(e){console.error("Error al cerrar sesi\xf3n:",e)}};return(0,i.jsxs)(l.A,{fluid:!0,className:"px-4",children:[(0,i.jsx)(n.A,{className:"my-4",children:(0,i.jsx)(d.A,{children:(0,i.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"h3 mb-1",children:"Panel de Control - FijosDN"}),(0,i.jsxs)("p",{className:"text-muted mb-0",children:["Bienvenido/a, ",(null==s?void 0:s.nombre)||"Usuario"]}),(0,i.jsxs)("small",{className:"text-muted",children:["Rol: ",e]})]}),(0,i.jsx)(c.A,{variant:"outline-danger",onClick:x,children:"Cerrar Sesi\xf3n"})]})})}),(0,i.jsx)(n.A,{children:(0,i.jsx)(d.A,{children:(()=>{if(!e)return(0,i.jsx)(t.A,{children:(0,i.jsxs)(t.A.Body,{className:"text-center",children:[(0,i.jsx)("h4",{children:"Error al cargar el perfil"}),(0,i.jsx)("p",{children:"No pudimos cargar los datos de tu perfil. Esto puede deberse a que tu usuario no tiene un rol asignado en el sistema."}),(0,i.jsx)("p",{children:"Por favor, contacta al administrador."})]})});switch(e){case"master":return(0,i.jsx)(g,{});case"logistic":return(0,i.jsx)(y,{});case"employee":return(0,i.jsx)(S,{});default:return(0,i.jsx)(t.A,{children:(0,i.jsxs)(t.A.Body,{className:"text-center",children:[(0,i.jsxs)("h4",{children:["Rol no reconocido: '",e,"'"]}),(0,i.jsx)("p",{children:"Tu rol no es v\xe1lido para acceder a ning\xfan panel."}),(0,i.jsx)("p",{children:"Por favor, contacta al administrador del sistema."})]})})}})()})})]})}},8269:(e,s,r)=>{"use strict";r.d(s,{db:()=>d});var i=r(6042),a=r(2964),t=r(9917),l=r(5226);let n=(0,i.Wp)({apiKey:"AIzaSyCZfCB30ZCrgfV787JNjZ5WoRrvgyN1GL0",authDomain:"pruebafijosdn.firebaseapp.com",projectId:"pruebafijosdn",storageBucket:"pruebafijosdn.firebasestorage.app",messagingSenderId:"479598312333",appId:"1:479598312333:web:e2ecd1de61bef748a85bc4",measurementId:"G-B0SNEXMG6B"}),d=(0,a.aU)(n);(0,t.xI)(n),(0,l.c7)(n)},8716:(e,s,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/Dashboard",function(){return r(6972)}])}},e=>{var s=s=>e(e.s=s);e.O(0,[671,871,400,493,636,593,792],()=>s(8716)),_N_E=e.O()}]);